<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Admin | Gerenciador de Pods</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/static/css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="cyber-bg">
  <div class="container py-4">
    <!-- Header -->
    <header class="mb-4 text-center">
      <div class="glow-container mb-3">
        <h1 class="neon-text mb-0">Administração de Pods</h1>
      </div>
      <p class="cyber-text">Gerencie seu inventário com estilo</p>
    </header>

    <!-- Control Panel -->
    <div class="control-panel mb-4">
      <div class="row">
        <div class="col-md-6 mb-3 mb-md-0">
          <div class="d-flex">
            <div class="search-wrapper">
              <i class="bi bi-search search-icon"></i>
              <input type="text" id="searchInput" class="form-control cyber-input" placeholder="Buscar produto...">
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="d-flex justify-content-md-end">
            <div class="dropdown me-2">
              <button id="btnImportExport" class="btn cyber-btn cyber-btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-arrow-down-up"></i> Importar/Exportar
              </button>
              <ul class="dropdown-menu cyber-dropdown">
                <li><a class="dropdown-item" href="#" id="btnExportJSON"><i class="bi bi-download"></i> Exportar (JSON)</a></li>
                <li><a class="dropdown-item" href="#" id="btnExportCSV"><i class="bi bi-file-spreadsheet"></i> Exportar (CSV)</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#" id="btnImport"><i class="bi bi-upload"></i> Importar</a></li>
              </ul>
            </div>
            <button id="btnAddProduct" class="btn cyber-btn cyber-btn-primary me-2">
              <i class="bi bi-plus-lg"></i> Novo Produto
            </button>
            <button id="btnViewLogs" class="btn cyber-btn cyber-btn-info me-2">
              <i class="bi bi-journal-text"></i> Ver Logs
            </button>
            <button id="btnInsights" class="btn cyber-btn cyber-btn-secondary me-2">
              <i class="bi bi-graph-up"></i> Insights
            </button>
            <button id="btnDeleteAll" class="btn cyber-btn cyber-btn-danger">
              <i class="bi bi-trash"></i> Apagar Tudo
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
      <div class="col-md-3 col-sm-6 mb-3 mb-md-0">
        <div class="cyber-card stats-card">
          <div class="cyber-card-body text-center">
            <i class="bi bi-box-seam stats-icon"></i>
            <h3 class="stats-number" id="totalProducts">0</h3>
            <p class="stats-label">Total de Produtos</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-3 mb-md-0">
        <div class="cyber-card stats-card">
          <div class="cyber-card-body text-center">
            <i class="bi bi-currency-dollar stats-icon"></i>
            <h3 class="stats-number" id="totalValue">R$ 0,00</h3>
            <p class="stats-label">Valor Total</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-3 mb-sm-0">
        <div class="cyber-card stats-card">
          <div class="cyber-card-body text-center">
            <i class="bi bi-x-circle stats-icon"></i>
            <h3 class="stats-number" id="zeroStockCount">0</h3>
            <p class="stats-label">Estoque Zerado</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="cyber-card stats-card">
          <div class="cyber-card-body text-center">
            <i class="bi bi-exclamation-triangle stats-icon"></i>
            <h3 class="stats-number" id="lowStockCount">0</h3>
            <p class="stats-label">Baixo Estoque</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters Panel (collapsed by default) -->
    <div class="cyber-card mb-4">
      <div class="cyber-card-header d-flex justify-content-between align-items-center">
        <button class="btn cyber-btn-sm cyber-btn-outline w-100 text-start d-flex justify-content-between align-items-center" 
                type="button" data-bs-toggle="collapse" data-bs-target="#filtersCollapse" 
                aria-expanded="false" aria-controls="filtersCollapse">
          <span><i class="bi bi-funnel me-2"></i> Filtros Avançados</span>
          <i class="bi bi-chevron-down"></i>
        </button>
      </div>
      <div class="collapse" id="filtersCollapse">
        <div class="cyber-card-body">
          <form id="filtersForm">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Categoria</label>
                <select class="form-select cyber-input" id="filterCategory">
                  <option value="">Todas as Categorias</option>
                  <option value="pod">Pod</option>
                  <option value="mod">Mod</option>
                  <option value="acessorio">Acessório</option>
                  <option value="liquido">Líquido</option>
                  <option value="outro">Outro</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Tags</label>
                <select class="form-select cyber-input" id="filterTag">
                  <option value="">Todas as Tags</option>
                  <!-- Tags will be populated dynamically -->
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Faixa de Preço</label>
                <div class="d-flex">
                  <input type="number" class="form-control cyber-input me-2" id="filterPriceMin" placeholder="Mín" min="0" step="0.01">
                  <input type="number" class="form-control cyber-input" id="filterPriceMax" placeholder="Máx" min="0" step="0.01">
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Status do Estoque</label>
                <div class="d-flex flex-wrap mt-2">
                  <div class="form-check me-3">
                    <input class="form-check-input cyber-checkbox" type="checkbox" id="filterLowStock">
                    <label class="form-check-label" for="filterLowStock">Baixo Estoque</label>
                  </div>
                  <div class="form-check me-3">
                    <input class="form-check-input cyber-checkbox" type="checkbox" id="filterZeroStock">
                    <label class="form-check-label" for="filterZeroStock">Estoque Zerado</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input cyber-checkbox" type="checkbox" id="filterPromotion">
                    <label class="form-check-label" for="filterPromotion">Em Promoção</label>
                  </div>
                </div>
              </div>
              <div class="col-12 text-end">
                <button type="button" class="btn cyber-btn cyber-btn-secondary me-2" id="clearFilters">
                  <i class="bi bi-x-circle"></i> Limpar Filtros
                </button>
                <button type="button" class="btn cyber-btn cyber-btn-primary" id="applyFilters">
                  <i class="bi bi-funnel"></i> Aplicar Filtros
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Main Content Tabs -->
    <ul class="nav nav-tabs cyber-tabs mb-3" id="mainTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="products-tab" data-bs-toggle="tab" data-bs-target="#products-tab-pane" 
                type="button" role="tab" aria-controls="products-tab-pane" aria-selected="true">
          <i class="bi bi-grid"></i> Produtos
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="insights-tab" data-bs-toggle="tab" data-bs-target="#insights-tab-pane" 
                type="button" role="tab" aria-controls="insights-tab-pane" aria-selected="false">
          <i class="bi bi-graph-up"></i> Insights & Métricas
        </button>
      </li>
    </ul>

    <div class="tab-content" id="mainTabsContent">
      <!-- Products Tab -->
      <div class="tab-pane fade show active" id="products-tab-pane" role="tabpanel" aria-labelledby="products-tab" tabindex="0">
        <div class="cyber-card main-card">
          <div class="cyber-card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Lista de Produtos</h5>
            <div class="d-flex">
              <div class="me-2">
                <div id="autoSaveIndicator" class="cyber-badge">
                  <i class="bi bi-check-circle-fill"></i> Auto-save Ativo
                </div>
              </div>
              <button id="sortByName" class="btn cyber-btn-sm cyber-btn-outline me-2">
                <i class="bi bi-sort-alpha-down"></i> Nome
              </button>
              <button id="sortByStock" class="btn cyber-btn-sm cyber-btn-outline me-2">
                <i class="bi bi-sort-numeric-down"></i> Estoque
              </button>
              <button id="sortByPrice" class="btn cyber-btn-sm cyber-btn-outline">
                <i class="bi bi-sort-numeric-down"></i> Preço
              </button>
            </div>
          </div>
          <div class="cyber-card-body">
            <div id="productsContainer" class="row g-3">
              <!-- Products will be loaded here dynamically -->
              <div class="col-12 text-center py-5">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Carregando...</span>
                </div>
                <p class="mt-2 text-muted">Carregando produtos...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Insights Tab -->
      <div class="tab-pane fade" id="insights-tab-pane" role="tabpanel" aria-labelledby="insights-tab" tabindex="0">
        <div class="row">
          <!-- Donut Chart - Categorias -->
          <div class="col-lg-6 mb-4">
            <div class="cyber-card h-100">
              <div class="cyber-card-header">
                <h5 class="mb-0">Distribuição por Categoria</h5>
              </div>
              <div class="cyber-card-body">
                <div class="chart-container">
                  <canvas id="categoriesChart"></canvas>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Bar Chart - Top Produtos por Estoque -->
          <div class="col-lg-6 mb-4">
            <div class="cyber-card h-100">
              <div class="cyber-card-header">
                <h5 class="mb-0">Top Produtos por Estoque</h5>
              </div>
              <div class="cyber-card-body">
                <div class="chart-container">
                  <canvas id="topStockChart"></canvas>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Tabela de Produtos com Estoque Zerado -->
          <div class="col-lg-6 mb-4">
            <div class="cyber-card h-100">
              <div class="cyber-card-header">
                <h5 class="mb-0">Produtos com Estoque Zerado</h5>
              </div>
              <div class="cyber-card-body">
                <div class="table-responsive">
                  <table class="table table-dark table-hover cyber-table">
                    <thead>
                      <tr>
                        <th>Nome</th>
                        <th>Categoria</th>
                        <th>Preço</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody id="zeroStockTable">
                      <!-- Will be populated dynamically -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Tabela de Produtos com Baixo Estoque -->
          <div class="col-lg-6 mb-4">
            <div class="cyber-card h-100">
              <div class="cyber-card-header">
                <h5 class="mb-0">Produtos com Baixo Estoque</h5>
              </div>
              <div class="cyber-card-body">
                <div class="table-responsive">
                  <table class="table table-dark table-hover cyber-table">
                    <thead>
                      <tr>
                        <th>Nome</th>
                        <th>Categoria</th>
                        <th>Estoque</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody id="lowStockTable">
                      <!-- Will be populated dynamically -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add/Edit Product Modal -->
  <div class="modal fade" id="productModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content cyber-modal">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitle">Adicionar Produto</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="productForm">
            <input type="hidden" id="productId">
            <div class="mb-3">
              <label for="productName" class="form-label">Nome do Produto</label>
              <input type="text" class="form-control cyber-input" id="productName" required>
            </div>
            <div class="mb-3">
              <label for="productPrice" class="form-label">Preço (R$)</label>
              <input type="number" class="form-control cyber-input" id="productPrice" step="0.01" min="0" required>
            </div>
            <div class="mb-3">
              <label for="productStock" class="form-label">Estoque</label>
              <input type="number" class="form-control cyber-input" id="productStock" min="0" required>
            </div>
            <div class="mb-3">
              <label for="productImage" class="form-label">URL da Imagem</label>
              <input type="text" class="form-control cyber-input" id="productImage" placeholder="https://exemplo.com/imagem.jpg">
              <div id="imagePreview" class="mt-2 text-center d-none">
                <img src="" alt="Preview" class="img-thumbnail cyber-thumbnail">
              </div>
            </div>
            <div class="mb-3">
              <label for="productCategory" class="form-label">Categoria</label>
              <select class="form-select cyber-input" id="productCategory">
                <option value="pod">Pod</option>
                <option value="mod">Mod</option>
                <option value="acessorio">Acessório</option>
                <option value="liquido">Líquido</option>
                <option value="outro">Outro</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="productTags" class="form-label">Tags</label>
              <input type="text" class="form-control cyber-input" id="productTags" placeholder="Separadas por vírgula (ex: frutado, ice, forte)">
              <div class="mt-2" id="tagsContainer">
                <!-- Tags will be displayed here -->
              </div>
              <div class="small text-muted mt-1">Digite as tags separadas por vírgula ou selecione abaixo:</div>
              <div class="mt-2 common-tags">
                <button type="button" class="btn cyber-btn cyber-btn-tag tag-ice me-1 mb-1" data-tag="ice">#ice</button>
                <button type="button" class="btn cyber-btn cyber-btn-tag tag-frutado me-1 mb-1" data-tag="frutado">#frutado</button>
                <button type="button" class="btn cyber-btn cyber-btn-tag tag-forte me-1 mb-1" data-tag="forte">#forte</button>
                <button type="button" class="btn cyber-btn cyber-btn-tag tag-tabaco me-1 mb-1" data-tag="tabaco">#tabaco</button>
                <button type="button" class="btn cyber-btn cyber-btn-tag tag-mentolado me-1 mb-1" data-tag="mentolado">#mentolado</button>
              </div>
            </div>
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input cyber-checkbox" id="productPromotion">
              <label class="form-check-label" for="productPromotion">Produto em Promoção</label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn cyber-btn cyber-btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn cyber-btn cyber-btn-primary" id="saveProduct">Salvar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- View Logs Modal -->
  <div class="modal fade" id="logsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content cyber-modal">
        <div class="modal-header">
          <h5 class="modal-title">Logs de Atividades</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="table-responsive">
            <table class="table table-dark table-hover cyber-table">
              <thead>
                <tr>
                  <th>Data/Hora</th>
                  <th>Produto</th>
                  <th>Ação</th>
                  <th>Detalhes</th>
                </tr>
              </thead>
              <tbody id="logsTableBody">
                <!-- Logs will be loaded here dynamically -->
              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn cyber-btn cyber-btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div class="modal fade" id="confirmationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content cyber-modal cyber-modal-danger">
        <div class="modal-header">
          <h5 class="modal-title">Confirmação</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p id="confirmationMessage">Tem certeza que deseja realizar esta ação?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn cyber-btn cyber-btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn cyber-btn cyber-btn-danger" id="confirmAction">Sim, apagar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification Modal -->
  <div class="modal fade" id="notificationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content cyber-modal cyber-modal-primary">
        <div class="modal-header">
          <h5 class="modal-title">Notificação</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <div class="notification-icon mb-3">
            <i id="notificationIcon" class="bi bi-check-circle-fill fs-1"></i>
          </div>
          <p id="notificationMessage">Operação realizada com sucesso!</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn cyber-btn cyber-btn-primary" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/static/js/script.js"></script>
</body>
</html>